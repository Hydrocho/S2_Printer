<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S2 Mini í”„ë¦°í„° ì—°ê²°</title>
    <style>
        body { font-family: sans-serif; padding: 20px; text-align: center; }
        button { padding: 15px 30px; font-size: 18px; margin: 10px; width: 80%; border-radius: 10px; border: none; }
        .btn-connect { background-color: #007bff; color: white; }
        .btn-print { background-color: #28a745; color: white; }
        #status { margin-top: 20px; color: #666; }
    </style>
</head>
<body>

    <h2>S2 Mini ì›¹ í”„ë¦°í„°</h2>
    <p>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ í”„ë¦°í„°ë¥¼ ì—°ê²°í•˜ì„¸ìš”.</p>

    <button class="btn-connect" onclick="connectToPrinter()">ğŸ”µ ë¸”ë£¨íˆ¬ìŠ¤ ì—°ê²°</button>
    <br>
    <button class="btn-print" onclick="printTest()">ğŸ–¨ï¸ ì¢…ì´ ë°€ê¸° (Feed)</button>

    <div id="status">ìƒíƒœ: ì—°ê²° ëŒ€ê¸°ì¤‘...</div>

    <script>
        let printCharacteristic = null;

        // 1. S2 Mini ì—°ê²° í•¨ìˆ˜
        async function connectToPrinter() {
            try {
                updateStatus("ì¥ì¹˜ ê²€ìƒ‰ ì¤‘...");
                
                // ìŠ¤í¬ë¦°ìƒ·ì—ì„œ ì°¾ì€ UUID ì…ë ¥
                const device = await navigator.bluetooth.requestDevice({
                    filters: [{ namePrefix: 'S2' }], // ì´ë¦„ì´ S2ë¡œ ì‹œì‘í•˜ëŠ” ê¸°ê¸° ì°¾ê¸°
                    optionalServices: [0x18f0]       // ì„œë¹„ìŠ¤ UUID (0x18F0)
                });

                updateStatus("GATT ì„œë²„ ì—°ê²° ì¤‘...");
                const server = await device.gatt.connect();

                updateStatus("ì„œë¹„ìŠ¤ ì°¾ëŠ” ì¤‘...");
                const service = await server.getPrimaryService(0x18f0);

                updateStatus("ì“°ê¸° ì±„ë„(Characteristic) ì°¾ëŠ” ì¤‘...");
                // ìŠ¤í¬ë¦°ìƒ·ì—ì„œ ì°¾ì€ Write UUID (0x2AF1)
                printCharacteristic = await service.getCharacteristic(0x2af1);

                updateStatus("âœ… ì—°ê²° ì„±ê³µ! ì¸ì‡„ ì¤€ë¹„ ì™„ë£Œ.");
                alert("ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤! ì´ì œ ì¸ì‡„ ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”.");

            } catch (error) {
                console.error(error);
                updateStatus("âŒ ì—°ê²° ì‹¤íŒ¨: " + error);
            }
        }

        // 2. í…ŒìŠ¤íŠ¸ ì¸ì‡„ (ì¢…ì´ ë°€ê¸°)
        async function printTest() {
            if (!printCharacteristic) {
                alert("ë¨¼ì € í”„ë¦°í„°ë¥¼ ì—°ê²°í•´ì£¼ì„¸ìš”!");
                return;
            }

            try {
                // S2 Miniìš© ê°„ë‹¨í•œ Feed ëª…ë ¹ì–´ (Hex: 1B 4A 40 - 64ë§Œí¼ ë°€ê¸°)
                // ë§Œì•½ ë°˜ì‘ì´ ì—†ìœ¼ë©´ ê¸°ì¢…ì— ë”°ë¼ ëª…ë ¹ì–´ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                // í…ìŠ¤íŠ¸ ëŒ€ì‹  'Byte ë°°ì—´'ì„ ë³´ë‚´ì•¼ í•©ë‹ˆë‹¤.
                const feedCommand = new Uint8Array([0x1B, 0x4A, 0x40]); 
                
                await printCharacteristic.writeValue(feedCommand);
                updateStatus("ë°ì´í„° ì „ì†¡ ì™„ë£Œ!");
            } catch (error) {
                updateStatus("âŒ ì „ì†¡ ì‹¤íŒ¨: " + error);
            }
        }

        function updateStatus(msg) {
            document.getElementById('status').innerText = msg;
        }
    </script>
</body>
</html>
